<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link type="image/x-icon" rel="icon" href="favicon.ico" />
<link type="image/x-icon" rel="shortcut icon" href="favicon.ico" />
<!--[if IE]><script type="text/javascript" src="js/html5.js"></script><![endif]-->
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" type="text/css" href="/css/vim-like.css" />
<title>Velocity-Notes - 闲耘™.Wiki</title>
</head>
<body>
<div id="wrapper">
<header>
<nav>
    <ul>
        <li class="first"><a href="http://hotoo.me/" title="Home">Home</a></li>
        <li><a href="http://blog.hotoo.me/" title="Blog">Blog</a></li>
        <li class="actived"><a href="http://wiki.hotoo.me/" title="Wiki">Wiki</a></li>
        <li><a href="https://twitter.com/hotoo" title="Twitter">Twitter</a></li>
        <li class="last"><a href="http://github.com/hotoo" title="Project">Project</a></li>
        <!-- li class="last"><a href="../resume/resume.html" title="About Me">README</a></li -->
    </ul>
</nav>
</header>
<article>

<h1 id="toc_1">Velocity Notes</h1>

<h2 id="toc_1.1">变量名</h2>
<dl>
<dt><code>$name</code></dt>
<dd>为空时打印变量本身。</dd>
<dt><code>$!name</code> </dt>
<dd>为空时打印空字符串（不打印任何内容）。</dd>
<dt><code>${name}</code> </dt>
<dd>类似 <code>$name</code>，为空时原样打印。但可以将变量和连续的字符串分隔，例如：<code>${name}space</code>。</dd>
<dt><code>$!{name}</code></dt>
<dd>类似 <code>$!name</code>，为空时打印空字符串，但可以将变量和连续的字符串分隔。例如： <code>$!{name}space</code>。</dd>
</dl>

<table>
<tr>
<th>&nbsp;</th>
<th>$name</th>
<th>$!name</th>
<th>${name}</th>
<th>$!{name}</th>
</tr>
<tr>
<td>为空时打印：</td>
<td>"$name"</td>
<td>""</td>
<td>"${name}"</td>
<td>""</td>
</tr>
</table>

<p>
带花括号的属性/方法调用方式，属性/方法需要在花括号之内：
</p>
<pre>
${cookie.name}
${request.getCookies()}
</pre>

<h2 id="toc_1.2">#set()</h2>
<pre>
#set($list = ["pine", "oak", "maple"])
</pre>
<p>
<strong>注：</strong> 如果右侧的值为 null，则赋值失败，左侧变量仍保持原值。
</p>

<h2 id="toc_1.3">#if()</h2>
<pre>
#if(true)
    TRUE.
#elseif(false)
    FALSE.
#end
</pre>

<p>
其实不仅仅是变量名可以使用花括号，保留字同样可以使用，这在内联 Velocity 脚本的时候
非常有用。
例如：
</p>
<pre>
&lt;div class="#{if}(false)className1#{elseif}(true)className2#{else}className3#{end}"&gt;&lt;/div&gt;
</pre>

<h2 id="toc_1.4">#foreach()</h2>
<pre>
#foreach($item in $list)
    ${velocityCount}. $item.
#end
</pre>

<h2 id="toc_1.5">#break</h2>
<p>
可用于中断 <code>#foreach()</code> 循环。
</p>

<h2 id="toc_1.6">#parse()</h2>
<p>
如果 a.vm <code>#parse("b.vm")</code>，b.vm 可以直接使用 a.vm 中定义的变量。
注意：如果 b.vm 定义了同名变量，则 b.vm 中使用自身的定义。
</p>

<h2 id="toc_1.7">#evaluate()</h2>
<p>
动态执行一串字符串的值：
</p>
<pre>
#evaluate('string with VTL #if(true)will be displayed#end')
</pre>

<h2 id="toc_1.8">#include()</h2>
<p>
将文件原文包含进当前文档中。
</p>
<pre>
#include("a.vm" "readme.txt")
</pre>

<h2 id="toc_1.9">数组&amp;访问</h2>
<p>
Velocity 只能访问对象，无法通过类似 arr[2] 来访问特定位置的元素。
</p>

<h2 id="toc_1.10">#macros()</h2>
<pre>
#macro(macroName)
    #subMacro("name", "value")
#end

#macro(subMacro $param1 $param2)
    this is sub macro($param1, $param2).
#end
</pre>

<p>
注意：如果 a.vm 和 b.vm 都在页面级存在同名，参数数量相同的宏，则后访问的页面
的宏不被加载。
</p>

<h2 id="toc_1.11">#stop</h2>
<p>
停止模板引擎，在 Debug 时比较有用。
</p>

<h2 id="toc_1.12">转义</h2>
<p>
暂无
</p>

<h2 id="toc_1.13">不解析执行的内容</h2>
<pre>
#[[
    这段内容将不被 Velocity 引擎解析，原文打出。

    * #define()
    * ${blah

]]#
</pre>

<h2 id="toc_1.14">内置对象</h2>
<p>
<code>$request</code>, <code>$response</code>, <code>$session</code>
</p>
<pre>
#foreach($cookie in $request.getCookies())
    $cookie.name : $cookie.value
#end
</pre>

<p>
获得 URL 中的参数：
</p>
<pre>
#set($n = $!request.getParameter('n'))
</pre>

<p>
另外还可以使用 <code>$msg</code> 内的消息工具访问 Struts 的国际化资源。
</p>

<h2 id="toc_1.15">注释</h2>
<pre>
## 单行注释。
#*
 * 多行注释。
 *#

#**
 * 文档风格的注释。
 * @version 2010/12/27
 *#
</pre>

<p>
据说 vm 页面的末尾写注释，会导致解析异常 (SofaMVC?)。
</p>

<h2 id="toc_1.16">Tips</h2>
<p>
Velocity 在表单中添加 name="action" 的文本/隐藏域，可以调用对应 Java 类
（submit 按钮的 name 则指定对应的方法名称，如 event_submit_do_save ），
但是此时 IE 浏览器无法通过 js 获得 form 本身的 action 属性。
其他浏览器可以通过 getAttribute 函数获得。
</p>

<p>
Form 本身的 action 属性和 action 隐藏域在提交时，浏览器本身不受影响，
action 隐藏域被当作正常的参数附在 Form 的 action 属性值所对应 URL 之后。
</p>

<h2 id="toc_1.17">延伸阅读</h2>
<ol>
<li>
<a href="Velocity.html">Velocity</a>
</li>
<li>
<a href="Alipay-SofaMVC.html">Alipay-SofaMVC</a>
</li>
<li>
<a href="http://velocity.apache.org/engine/releases/velocity-1.7/vtl-reference-guide.html">VTL Reference</a>
</li>
</ol>

<script type="text/javascript">
function onSearch(){
    location.href = "search.html#"+document.getElementById("input_search").value;
    return false;
}
</script>
<div style="border-top:1px solid #ccc; background:#f6f6f6 none;padding:8px;">
    <form action="search.html" id="searchbox" onsubmit="return onSearch();">
        <input type="text" name="q" id="input_search" />
        <input type="submit" value="搜索" />
    </form>
</div>
</article>
<footer>
    <a href="index.html" id="back-home">&lsaquo; 首页</a>
    <p><a rel="license" href="http://creativecommons.org/licenses/by/2.5/"><img alt="Creative Commons License" style="border-width: 0pt;" src="http://i.creativecommons.org/l/by/2.5/88x31.png" align="right"></a>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/2.5/">Creative Commons Attribution 2.5 Generic License</a>.<br>
    Copyleft © 2010, Driven by <a href="http://code.google.com/p/vimwiki/">Vimwiki</a>, Theme by 闲耘™(@hotoo).
    </p>
    <p>本页最后修订于 2010年12月30日 13:29:41</p>
</footer>
</div>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<!--[if lte IE 6]><script type="text/javascript" src="js/ie6.js"></script><![endif]-->
<!-- <script type="text/javascript" src="js/WikiWords.js"></script>
<script type="text/javascript" src="js/vim-like.js"></script> -->

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-15922433-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
